# Deterministic error -> fix templates.
# Each rule: name, match_regex (case-insensitive), fix_command (template), confidence (0-1), explanation
# fix_command can include capture groups like $1 and placeholders like {{pkg}} if you extend the template engine.

rules:
  - name: missing_module_node
    match_regex: "(?i)error: Cannot find module '(?P<module>[^']+)'|Module not found: Error: Can't resolve '(?P<module2>[^']+)'"
    fix_command: "npm install --save {{module}}"
    confidence: 0.86
    explanation: "Installs the missing npm module."

  - name: permission_denied_generic
    match_regex: "(?i)permission denied|EACCES|AccessDenied"
    fix_command: "sudo chown $(whoami) -R . && chmod u+rwx -R ."
    confidence: 0.6
    explanation: "Change ownership of current directory to your user. Review before running."

  - name: apt_missing_pkg
    match_regex: "(?i)error: '(.+)' not found|package '(.+)' is not installed"
    fix_command: "sudo apt-get update && sudo apt-get install -y $1"
    confidence: 0.7
    explanation: "Install the missing apt package (Debian/Ubuntu)."

  - name: missing_shared_lib
    match_regex: "(?i)error while loading shared libraries: (lib[^:]+): cannot open shared object file: No such file or directory"
    fix_command: "sudo apt-get install -y libssl-dev libcrypto++-dev || apk add --no-cache libssl1.1"
    confidence: 0.65
    explanation: "Installs common SSL/crypto libraries; adapt to your distro."

  - name: node_gyp_build_fail
    match_regex: "(?i)node-gyp rebuild|gyp ERR! build error"
    fix_command: "npm install --global node-gyp && sudo apt-get install -y python3 make g++ || apk add --no-cache python3 make g++"
    confidence: 0.7
    explanation: "Installs build tools needed for native modules."